<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>회원가입</title>
  <style>
    body {
      background-color: #0a0a0a;
      color: white;
      font-family: Arial, sans-serif;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .signup-box {
      background-color: #1a1a1a;
      padding: 30px;
      border-radius: 10px;
      width: 400px;
      box-shadow: 0 0 20px rgba(255,255,255,0.05);
    }

    h2 {
      text-align: center;
      color: #c1dbe3;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }

    input[readonly] {
      background-color: #333;
      color: #999;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #c1dbe3;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .small {
      font-size: 0.85rem;
      margin-top: -8px;
      color: #aaa;
    }

    .row {
      display: flex;
      gap: 10px;
    }
    .row input {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="signup-box">
    <h2>회원가입</h2>
    <form id="signup-form">
      <input type="text" id="userid" placeholder="아이디" required />
      <button type="button" onclick="checkDuplicate()">아이디 중복 확인</button>

      <input type="password" id="password" placeholder="비밀번호" required />
      <input type="text" id="name" placeholder="이름" required />

      <div class="row">
        <input type="number" id="height" placeholder="키(cm)" required />
        <input type="number" id="weight" placeholder="몸무게(kg)" required />
      </div>

      <input type="text" id="bmi" placeholder="BMI (자동 계산)" readonly />

      <select id="gender" required>
        <option value="">성별 선택</option>
        <option value="남">남자</option>
        <option value="여">여자</option>
      </select>

      <input type="email" id="email" placeholder="이메일" required />
      <input type="text" value="NONE" readonly />
      <input type="number" value="0" readonly />

      <button type="submit">회원가입</button>
    </form>
  </div>

  <script>
    // BMI 자동 계산
    document.getElementById('height').addEventListener('input', calculateBMI);
    document.getElementById('weight').addEventListener('input', calculateBMI);

    function calculateBMI() {
      const h = parseFloat(document.getElementById('height').value);
      const w = parseFloat(document.getElementById('weight').value);
      const bmiInput = document.getElementById('bmi');

      if (h && w) {
        const bmi = w / ((h / 100) ** 2);
        bmiInput.value = bmi.toFixed(2);
      } else {
        bmiInput.value = '';
      }
    }

    // 아이디 중복 체크
    async function checkDuplicate() {
      const userid = document.getElementById('userid').value;
      if (!userid) return alert('아이디를 입력해주세요.');
      const res = await fetch('/api/check-id', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userid })
      });
      const result = await res.json();
      if (res.ok) {
        alert('사용 가능한 아이디입니다.');
      } else {
        alert(result.message);
      }
    }

    // 회원가입
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        userid: document.getElementById('userid').value,
        password: document.getElementById('password').value,
        name: document.getElementById('name').value,
        height: parseFloat(document.getElementById('height').value),
        weight: parseFloat(document.getElementById('weight').value),
        bmi: parseFloat(document.getElementById('bmi').value),
        gender: document.getElementById('gender').value,
        email: document.getElementById('email').value,
        personalColor: "NONE",
        coin: 0
      };

      const res = await fetch('/api/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      if (res.ok) {
        alert('회원가입 성공!');
        window.location.href = '/login.html';
      } else {
        alert(result.message);
      }
    });
  </script>
</body>
</html>
